---
title: "Homework-2023.09.18"
author: "By SA23204156 程张伟"
date: "2023-09-19"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Homework-2023.09.18}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
   
## Overview  
   
The content is the homework of the course.

## Question  
  
Exercise 3.2   
   
## Answer   
   
根据密度函数可知拉普拉斯分布的分布函数为
$$
F(x)=\left\{
\begin{aligned}
 \frac12e^x   &&x<0\\
 1-\frac12e^{-x} &&x\geq0\\
\end{aligned}
\right.
$$

根据逆变换法生成样本
```{r,eval=FALSE}
u <- runif(1000) #生成均匀分布样本
x1 <- 1:1000
x1[which(u<0.5)] <- log(2*u[which(u<0.5)])   
x1[which(u>=0.5)] <- -log(2-2*u[which(u>=0.5)])    #利用逆变换得到Laplace分布的样本
```
   
将生成的样本与实际分布比较
```{r,eval=FALSE}
hist(x1, prob = TRUE, main = expression(f(x)==frac(1,2)*e^(-abs(x))))
curve(1/2*exp(-abs(x)), col = "red", add = TRUE, lwd =2)
```
   
   
## Question  
  
Exercise 3.7   
  
## Answer   
   
Beta(a,b)的密度函数为$f(x)=\frac{1}{B(a,b)}x^{a-1}(1-x)^{b-1}$,可以知道$x^{a-1}(1-x)^{b-1}$最大值为$\frac{(a-1)^{a-1}(b-1)^{b-1}}{(a+b-2)^{a+b-2}}$,因此可以选择接受拒绝法中的c为$\frac{1}{B(a,b)}\frac{(a-1)^{a-1}(b-1)^{b-1}}{(a+b-2)^{a+b-2}}$,g(x)选取[0,1]上的均匀分布,从而相应的$\rho(x)=\frac{f(x)}{cg(x)}$.   
   
```{r,eval=FALSE}
my.rbeta <- function(a,b,n){# Beta分布的参数和样本量
  k <- 0                    #k用来控制生成的样本量
  x <- numeric(n)           #用来储存生成的样本
  while (k < n) {
    u <- runif(1) #生成均匀分布
    y <- runif(1) #生成g(x)的样本
    c <- (a-1)^(a-1)*(b-1)^(b-1)/((a+b-2)^(a+b-2))
    rho_y <- y^(a-1)*(1-y)^(b-1) #计算rho(y)
    if(u <= rho_y){  #接受拒绝的过程
      x[k+1] <- y
      k <- k+1
    }
  }
  x                #返回生成的样本
}
```
   
生成Beta(3,2)的样本并比较
```{r,eval=FALSE}
x2 <- my.rbeta(3,2,1000)
hist(x2, prob = T, main = expression(f(x)==frac(1,B(3,2))*x^2*(1-x)))
curve(1/beta(3,2)*x^2*(1-x), col = "red", add = T, lwd =2)
```
   
## Question  
  
Exercise 3.9   
  
## Answer  

```{r,eval=FALSE}
my.repane <- function(n){  #指定样本量
  x <- numeric(n)
  k <- 0
  while (k < n) {    #按照算法得到样本
    k <- k+1
    u <- runif(3, -1, 1)
    if(which.max(abs(u))==3){
      x[k] <- u[2]
    } else 
    {
      x[k] <- u[3]
    }
  }
  x
}
```
   
生成样本并比较
```{r,eval=FALSE}
x3 <- my.repane(1000)
hist(x3, prob = T, main = expression(f(x)==frac(3,4)*(1-x^2)))
curve(3/4*(1-x^2), col = "red", add = T, lwd =2)
```

## Question  
  
Exercise 3.10   
  
## Answer   
   
$pf:$  
$假设生成的随机变量为X,则P(X<=x)=P(X<=x| |U_3|最大)P(|U_3|最大)+P(X<=x| |U_3|不是最大)P(|U_3|不是最大)$   
$由独立性可知P(|U_3|最大)=\frac{1}{3},P(|U_3|不是最大)=\frac{2}{3}$   
$P(X<=x| |U_3|最大)=3P(X<=x,|U_3|最大)=3P(U_2\leq x,|U_3|\geq|U_2|,|U_3|\geq|U_1|)$   
$若x\geq0,$    
$上式=3(\int_{-1}^{-x}\int_{u_3}^{x}\int_{u_3}^{-u_3}+\int_{-x}^{0}\int_{u_3}^{-u_3}\int_{u3}^{-u_3}+\int_{0}^{x}\int_{-u_3}^{u_3}\int_{-u_3}^{u_3}+\int_{x}^{1}\int_{-u_3}^{x}\int_{-u_3}^{u_3})\frac{1}{8}du_1du_2du_3$   
$=\frac{1}{2}+\frac{3}{4}x-\frac{1}{4}x^3$    

$若x<0,$    
$上式=3(\int_{-1}^{x}\int_{u_3}^{x}\int_{u_3}^{-u_3}+\int_{-x}^{1}\int_{-u_3}^{x}\int_{-u_3}^{u_3})\frac{1}{8}du_1du_2du_3$    
$=\frac{1}{2}+\frac{3}{4}x-\frac{1}{4}x^3$  
$综上,P(X<=x| |U_3|最大)=\frac{1}{2}+\frac{3}{4}x-\frac{1}{4}x^3$   
   
$P(X<=x| |U_3|不是最大)=\frac{3}{2}P(X<=x, |U_3|不是最大)=\frac{3}{2}P(U_3\leq x, |U_3|<|U_1|或|U_3|<|U_2|)$   
$由于U_1,U_2地位相同,所以上式=3P(U_3\leq x, |U_3|<|U_1|,|U_1|<|U_2|),这就和第一种情况相同$   
$因此P(X<=x| |U_3|不是最大)=\frac{1}{2}+\frac{3}{4}x-\frac{1}{4}x^3$   
   
$综上,P(X<=x)=\frac{1}{3}(\frac{1}{2}+\frac{3}{4}x-\frac{1}{4}x^3)+\frac{2}{3}(\frac{1}{2}+\frac{3}{4}x-\frac{1}{4}x^3)=\frac{1}{2}+\frac{3}{4}x-\frac{1}{4}x^3$   
   
$对上述分布函数求导可知,f_X(x)=\frac{3}{4}(1-x^2),即为题中所要求的密度函数,证毕.$   

  
## Question  
  
用逆变换法复现放回情况下的sample函数  
  
## Answer   
   
```{r,eval=FALSE}
my.sample <- function(x, size, prob = rep(1,length(x))){
  if(length(prob)!=length(x)){   # 判断变量输入是否合理
    print("The length of x and prob is not equal!")
  }else
  {
    p <- prob/sum(prob)
    cp <- cumsum(p)
    u <- runif(size)      # 生成均匀分布
    r <- x[findInterval(u,cp)+1]    #逆变换
    return(r)         #放回所生成的样本
  }
}
```
   
### 验证函数的正确性:   
未指定概率即默认等概率抽样
```{,eval=FALSE}
x4 <- my.sample(c(1,2,3,4), 1e5)   #不指定权重时生成样本
ct <- as.vector(table(x4))         #统计频率
ct/sum(ct)/rep(0.25,4)             #用比值进行比较每个取值的观测的频率和概率
```
   
指定概率但输入的概率程度与总体可能取值的长度不一致   
```{r,eval=FALSE}
x4 <- my.sample(c(1,2,3,4), 1e5, c(1))
```
   
指定概率且正确输入时   
```{r,eval=FALSE}
prob <- runif(4, 0, 10)  #随机生成权重
p <- prob/sum(prob)      #将权重转换为概率
x5 <- my.sample(c(1,2,3,4), 1e5, prob = prob)   #生成样本
ct <- as.vector(table(x5))          #统计频率
ct/sum(ct)/p             #用比值进行比较每个取值的观测的频率和概率
```
   
从上述的结果可以看出:当输入不当时,能够识别并报错;未指定概率(默认等概率)以及指定概率时,都可以按照我们所要求的概率进行抽样.   
