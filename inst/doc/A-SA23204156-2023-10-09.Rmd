---
title: "Homework-2023.10.09"
author: "By SA23204156 程张伟"
date: "2023-10-12"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Homework-2023.10.09}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
   
## Overview  
   
The content is the homework of the course.

## Question  
   
Proof that $Var(\hat{\theta}^S)/Var(\hat{\theta}^M)\rightarrow0$   
   
## Answer    
   
pf:   
注意到$Var(\hat{\theta}^M)$与层的选取无关,因此只需证明$Var(\hat{\theta}^S)\rightarrow0$    
$而Var(\hat{\theta}^S)=\frac{1}{Mk}\sum_{i=1}^{k}\sigma_i^2$   
$\sigma_i^2=Var[g(U)|I=i]=\int_{a_i}^{b_i}\frac{1}{b_i-a_i}(g(x)-E[g(U)])^2dx\leq N_i^2(其中N_i表示g在第i个区间上最大最小值之差)$   
$而g在[a,b]上是一致连续的,因此\forall\epsilon>0,存在\delta>0,s.t.|x-y|<\delta时,|g(x)-g(y)|<\sqrt{\epsilon}$   
$从而当b_i-a_i<\delta时,N_i^2<\epsilon\Rightarrow Var(\hat{\theta}^S)<\frac{\epsilon}{M}<\epsilon$   
$由\epsilon的任意性我们知道结论成立$   
   
## Question  
   
ex5.13    
Find importance functions $f_1$ and $f_2$ close to $g(x)=\frac{x^2}{\sqrt{2\pi}}e^{-{x^2}/{2}}$, comparing the variance
   
## Answer   
   

$f_1=e^{-(x-1)}$, $(x>1)$   
```{r,eval=FALSE}
m <- 1e6
theta.hat <- se <- numeric(2)
g <- function(x){
  x^2/sqrt(2*pi)*exp(-x^2/2)
}
f1 <- function(x){
  exp(-x+1)
}
x <- 1 + rexp(m)
theta.hat[1] <- mean(g(x)/f1(x))
se[1] <- sd(g(x)/f1(x))
```
   
$f_2=\sqrt{\frac{2}{\pi}}e^{-(x-1)^2/2}$
```{r,eval=FALSE}
f2 <- function(x){
  sqrt(2/pi)*exp(-(x-1)^2/2)
}
x <- 1 + abs(rnorm(m, 1, 1) - 1)
theta.hat[2] <- mean(g(x)/f2(x))
se[2] <- sd(g(x)/f2(x))
```

```{r,eval=FALSE}
integrate(g, 1, Inf)
```
  
```{r,eval=FALSE}
rbind(theta.hat, se)
```
  
实际积分结果为0.400626,表中的估计值也较为接近但可以看出第二种的标准差更小，这是因为我们选取的$f_2$要更为接近$g$.   
   
## Question  
   
ex5.14    
估计$g(x)=\frac{x^2}{\sqrt{2\pi}}e^{-{x^2}/{2}}$的积分
   
## Answer    
   
在上一题中已经对g(x)的积分做了估计   
    
## Question  
   
ex5.15    
用分层的方法估计$\int_0^1\frac{e^{-x}}{1+x^2}dx$,并与不分层的方法比较
   
## Answer    
   
根据例5.13中可知,不分层的结果中$\hat\theta=0.5257801,标准差为0.0970314$.现在将区间分为$((j-1)/5,j/5),j=1,2,3,4,5$    
在每个区间上生成数据的密度为$f_j(x)=e^{-x}/\alpha_j,\alpha_j=(e^{-(j-1)/5}-e^{-j/5})/(1-e^{-1})$    
   
```{r,eval=FALSE}
m <- 1e4
k <- 5
theta.hat2 <- numeric(5)
se2 <- numeric(5)
g2 <- function(x){
  exp(-x)/(1+x^2)
}
f3 <- function(x,j){
  exp(-x)/(exp(-(j-1)/5)-exp(-j/5))
}
for (j in 1:5) {
  u <- runif(m/k)
  x <- -log(exp(-(j-1)/5) - u*(exp(-(j-1)/5)-exp(-j/5)))
  theta.hat2[j] <- mean(g2(x)/f3(x,j))
  se2[j] <- sd(g2(x)/f3(x,j))
}
theta.hat3 <- sum(theta.hat2)
se3 <- sqrt(1/(m*k)*sum(se2^2))
```
   
```{r,eval=FALSE}
rbind(theta.hat3, se3)
```
   
分层的结果估计值依然很准确,但是可以看到标准差明显减小.   
    
## Question  
   
ex6.5    
用MC方法计算t置信区间在卡方分布下的覆盖率
   
## Answer   
   
```{r,eval=FALSE}
n = 20
alpha <- 0.05
UCL <- LCL <- numeric(1000)
for (j in 1:1000) {
  x <- rchisq(n, df = 2)
  UCL[j] <- mean(x) + sd(x)/sqrt(n)*qt(1 - alpha/2, df = n-1)
  LCL[j] <- mean(x) - sd(x)/sqrt(n)*qt(1 - alpha/2, df = n-1)
}
mean(UCL > 2 & LCL < 2)
```
   
从结果可以看出在非正态的情况下覆盖率与0.95有所差距.   
   
## Question  
   
ex6.A    
计算在卡方,均匀和指数分布下t检验的一类错误率是否和名义显著性水平相同
   
## Answer  
  
$卡方分布\mathcal{X}^2(1)$
```{r,eval=FALSE}
error1 <- numeric(3) 
n = 20
alpha <- 0.05
T1 <- numeric(10000)
for (j in 1:10000) {
  x <- rchisq(n, df = 1)
  T1[j] <- sqrt(n)*(mean(x) - 1)/sd(x) 
}
error1[1] <- mean(abs(T1) > qt(1 - alpha/2, df = n-1))
```
   
$均匀分布U(0,2)$
```{r,eval=FALSE}
n = 20
alpha <- 0.05
T2 <- numeric(10000)
for (j in 1:10000) {
  x <- runif(n, 0, 2)
  T2[j] <- sqrt(n)*(mean(x) - 1)/sd(x) 
}
error1[2] <- mean(abs(T2) > qt(1 - alpha/2, df = n-1))
```
  
$指数分布exp(1)$  
```{r,eval=FALSE}
n = 20
alpha <- 0.05
T3 <- numeric(10000)
for (j in 1:10000) {
  x <- rexp(n)
  T3[j] <- sqrt(n)*(mean(x) - 1)/sd(x) 
}
error1[3] <- mean(abs(T3) > qt(1 - alpha/2, df = n-1))
```
   
```{r,eval=FALSE}
rbind(error1)
```
   
以上就是三种分布下的一类错误率,可以看到只有均匀分布的结果与显著性水平较为接近,这可能是因为均匀分布关于均值的对称性所导致的.